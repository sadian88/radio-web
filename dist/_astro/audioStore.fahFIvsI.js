class s{constructor(){if(s.instance)return s.instance;s.instance=this,this.subscribers=[],this.isPlaying=!1,this.isMuted=!1,this.isLoading=!1,this.volume=1,this.error=null,this.streamUrl="https://radio.saopaulo01.com.br/8000/stream",this.audio=new Audio,this.audio.preload="auto",this.audio.crossOrigin="anonymous",this.setupEventListeners()}setupEventListeners(){this.audio.addEventListener("playing",()=>{console.log("Audio playing event"),this.isPlaying=!0,this.isLoading=!1,this.error=null,this.notify()}),this.audio.addEventListener("pause",()=>{console.log("Audio pause event"),this.isPlaying=!1,this.isLoading=!1,this.notify()}),this.audio.addEventListener("waiting",()=>{console.log("Audio waiting/buffering"),this.isLoading=!0,this.notify()}),this.audio.addEventListener("error",i=>{console.error("Audio error:",i),this.isLoading=!1,this.error=i.message||"Error de reproducciÃ³n",this.isPlaying=!1,this.notify()}),this.audio.addEventListener("volumechange",()=>{console.log("Volume changed:",this.audio.volume,"Muted:",this.audio.muted),this.volume=this.audio.volume,this.isMuted=this.audio.muted,this.notify()}),this.audio.addEventListener("canplay",()=>{console.log("Stream ready to play"),this.isLoading=!1,this.error=null,this.notify()})}async togglePlay(){try{this.audio.src||(console.log("Iniciando stream con:",this.streamUrl),this.audio.src=this.streamUrl,this.audio.load()),this.isPlaying?(await this.audio.pause(),this.isPlaying=!1):(this.isLoading=!0,this.notify(),await this.audio.play(),this.isPlaying=!0),console.log("Toggle play - isPlaying:",this.isPlaying),this.notify()}catch(i){console.error("Error toggling play:",i),this.isLoading=!1,this.error=i.message,this.notify()}}async stopPlay(){try{this.audio.src&&(this.audio.pause(),this.audio.src="",this.audio.load(),this.isPlaying=!1,this.isLoading=!1,this.notify(),console.log("Stream detenido completamente"))}catch(i){console.error("Error stopping play:",i),this.error=i.message,this.notify()}}setVolume(i){this.audio.volume=i,console.log("Setting volume:",i),this.volume=i,this.notify()}toggleMute(){this.audio.muted=!this.audio.muted,console.log("Toggling mute:",this.audio.muted),this.isMuted=this.audio.muted,this.notify()}subscribe(i){return this.subscribers.push(i),i({isPlaying:this.isPlaying,isMuted:this.isMuted,volume:this.volume,isLoading:this.isLoading,error:this.error}),()=>{this.subscribers=this.subscribers.filter(t=>t!==i)}}notify(){const i={isPlaying:this.isPlaying,isMuted:this.isMuted,volume:this.volume,isLoading:this.isLoading,error:this.error};console.log("Notifying state:",i),this.subscribers.forEach(t=>t(i))}}const o=new s;export{o as a};
